LDFLAGS=-lm 
CCFLAGS=-g -std=c++11 -Wall -Wno-unused-variable -Wno-sign-compare -Wno-unused-function -O2 -fPIC -D_GLIBCXX_USE_CXX11_ABI=0
py_lib=
py_include=-I/python-header

CC=g++
build=build
src=src

hpp=${wildcard $(src)/*.hpp}
cpp=${wildcard $(src)/*.cpp}
obj=${patsubst $(src)/%.cpp, $(build)/%.o, $(cpp)}
target=_IOHprofiler.so

all: $(obj) $(target)
$(obj): $(build)/%.o: $(src)/%.cpp
	mkdir -p $(build)
	$(CC) ${CCFLAGS} -I./src -c -x c++ $^ -o $@ ${LDFLAGS}
$(target):
	swig -c++ -python IOHprofiler.i
	g++ -O2 -D_GLIBCXX_USE_CXX11_ABI=0 -fPIC -std=c++11 $(py_include) -c IOHprofiler_wrap.cxx 
	g++ -O2 -D_GLIBCXX_USE_CXX11_ABI=0 -shared -std=c++11 $(py_lib) $(obj) IOHprofiler_wrap.o -o $@ 

clean:
	rm -rf $(build) $(obj) $(target) IOHprofiler.py IOHprofiler_wrap.*
